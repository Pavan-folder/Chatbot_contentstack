<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amazon-Style Chatbot</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Open Sans', sans-serif;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background: linear-gradient(135deg, #232F3E 0%, #37475A 100%);
      color: white;
      border-radius: 8px;
    }
    .header h1 {
      margin: 0;
      font-size: 2.5rem;
      font-weight: 600;
    }
    .header p {
      margin: 10px 0 0 0;
      opacity: 0.9;
      font-size: 1.1rem;
    }
    .demo-info {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .demo-info h3 {
      color: #232F3E;
      margin-top: 0;
    }
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .feature {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #FF9900;
    }
    .feature h4 {
      color: #232F3E;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸ›’ Amazon-Style Chatbot</h1>
      <p>Experience our customer service chatbot with Amazon's signature design and functionality</p>
    </div>

    <div class="demo-info">
      <h3>âœ¨ Features</h3>
      <div class="features">
        <div class="feature">
          <h4>ðŸŽ¨ Amazon Design</h4>
          <p>Authentic Amazon-style interface with signature colors and typography</p>
        </div>
        <div class="feature">
          <h4>ðŸ’¬ Smart Responses</h4>
          <p>AI-powered customer service responses for products, orders, and support</p>
        </div>
        <div class="feature">
          <h4>ðŸ“± Responsive</h4>
          <p>Works perfectly on desktop and mobile devices</p>
        </div>
        <div class="feature">
          <h4>âš¡ Real-time</h4>
          <p>Streaming responses for natural conversation flow</p>
        </div>
      </div>
    </div>
  </div>

  <div id="root"></div>

  <!-- Load React and ReactDOM from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Load React Router -->
  <script src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js"></script>

  <!-- Main App Component -->
  <script type="module">
    // Amazon-style chatbot component
    const { useState, useRef, useEffect, useCallback } = React;

    const Message = ({ id, text, sender, timestamp }) => {
      const renderMarkdown = (text) => {
        let formattedText = text.replace(/\\*\\*(.*?)\\*\\*/g, '<strong style="font-weight: 600; color: #0F1111;">$1</strong>');
        formattedText = formattedText.replace(/\\*(.*?)\\*/g, '<em style="font-style: italic; color: #565959;">$1</em>');
        formattedText = formattedText.replace(/```([\\s\\S]*?)```/g, '<pre style="background: #F7F8F8; padding: 16px; border-radius: 8px; font-size: 13px; margin: 8px 0; border: 1px solid #D5D9D9; overflow-x: auto; font-family: \\"Monaco\\", \\"Menlo\\", monospace; color: #0F1111;">$1</pre>');
        formattedText = formattedText.replace(/`([^`]+)`/g, '<code style="background: #F1F3F3; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-family: \\"Monaco\\", \\"Menlo\\", monospace; color: #D73A49;">$1</code>');
        formattedText = formattedText.replace(/^### (.*$)/gim, '<h3 style="font-size: 18px; font-weight: 600; margin: 16px 0 8px 0; color: #0F1111;">$1</h3>');
        formattedText = formattedText.replace(/^## (.*$)/gim, '<h2 style="font-size: 20px; font-weight: 600; margin: 20px 0 10px 0; color: #0F1111;">$1</h2>');
        formattedText = formattedText.replace(/^# (.*$)/gim, '<h1 style="font-size: 24px; font-weight: 600; margin: 24px 0 12px 0; color: #0F1111;">$1</h1>');
        formattedText = formattedText.replace(/^\\* (.*$)/gim, '<li style="margin: 4px 0; padding-left: 8px; color: #0F1111;">$1</li>');
        formattedText = formattedText.replace(/^- (.*$)/gim, '<li style="margin: 4px 0; padding-left: 8px; color: #0F1111;">$1</li>');
        formattedText = formattedText.replace(/\\n\\n/g, '</p><p style="margin: 8px 0; line-height: 1.5; color: #0F1111;">');
        formattedText = formattedText.replace(/\\n/g, '<br/>');
        if (!formattedText.startsWith('<')) {
          formattedText = '<p style="margin: 8px 0; line-height: 1.5; color: #0F1111;">' + formattedText + '</p>';
        }
        return formattedText;
      };

      const styles = {
        message: {
          marginBottom: '16px',
          display: 'flex',
          flexDirection: 'column',
          alignSelf: sender === 'user' ? 'flex-end' : 'flex-start',
          maxWidth: sender === 'user' ? '80%' : '85%',
        },
        messageBubble: {
          padding: '12px 16px',
          borderRadius: '8px',
          wordWrap: 'break-word',
          fontSize: '14px',
          lineHeight: '1.4',
          position: 'relative',
        },
        userBubble: {
          backgroundColor: '#232F3E',
          color: '#FFFFFF',
          borderBottomRightRadius: '2px',
        },
        botBubble: {
          backgroundColor: '#FFFFFF',
          color: '#0F1111',
          border: '1px solid #D5D9D9',
          borderBottomLeftRadius: '2px',
          boxShadow: '0 1px 2px rgba(15, 17, 17, 0.08)',
        },
        timestamp: {
          fontSize: '11px',
          color: '#565959',
          marginTop: '4px',
          textAlign: sender === 'user' ? 'right' : 'left',
        },
      };

      return (
        <div style={styles.message}>
          <div
            style={{
              ...styles.messageBubble,
              ...(sender === 'user' ? styles.userBubble : styles.botBubble)
            }}
          >
            {sender === 'bot' ? (
              <div dangerouslySetInnerHTML={{ __html: renderMarkdown(text) }} />
            ) : (
              <div>{text}</div>
            )}
          </div>
          <div style={styles.timestamp}>
            {timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
          </div>
        </div>
      );
    };

    const AmazonStyleWidget = () => {
      const [isOpen, setIsOpen] = useState(false);
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);

      const messagesEndRef = useRef(null);
      const messagesContainerRef = useRef(null);

      const scrollToBottom = useCallback(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, []);

      useEffect(() => {
        scrollToBottom();
      }, [messages, scrollToBottom]);

      useEffect(() => {
        if (messages.length === 0) {
          const greetingMessage = {
            id: 'greeting',
            text: "Hello! I'm your customer service assistant. I'm here to help you with any questions about products, orders, or account issues. How can I assist you today?",
            sender: 'bot',
            timestamp: new Date(),
          };
          setMessages([greetingMessage]);
        }
      }, []);

      const sendMessage = async () => {
        if (!input.trim()) return;

        const userMessage = {
          id: Date.now().toString(),
          text: input,
          sender: 'user',
          timestamp: new Date(),
        };

        const apiMessages = [
          { role: 'system', content: 'You are a helpful Amazon customer service assistant. Be friendly, professional, and provide accurate information about products, orders, shipping, returns, and account issues. Always aim to resolve customer concerns efficiently.' },
          ...messages.map(m => ({ role: m.sender === 'user' ? 'user' : 'assistant', content: m.text })),
          { role: 'user', content: userMessage.text }
        ];

        setMessages(prev => [...prev, userMessage]);
        setInput('');
        setIsLoading(true);

        try {
          const response = await fetch('http://localhost:3006/chat', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ messages: apiMessages, provider: 'groq' }),
          });

          if (!response.ok) {
            throw new Error('Failed to send message');
          }

          const reader = response.body?.getReader();
          const decoder = new TextDecoder();

          const botMessage = {
            id: (Date.now() + 1).toString(),
            text: '',
            sender: 'bot',
            timestamp: new Date(),
          };

          setMessages(prev => [...prev, botMessage]);

          while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value, { stream: true });
            const lines = chunk.split('\\n');

            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') break;

                try {
                  const parsed = JSON.parse(data);
                  if (parsed.content) {
                    setMessages(prev =>
                      prev.map(msg =>
                        msg.id === botMessage.id ? { ...msg, text: msg.text + parsed.content } : msg
                      )
                    );
                  }
                } catch (e) {
                  // Ignore parsing errors
                }
              }
            }
          }
        } catch (error) {
          console.error('Error sending message:', error);
          const errorMessage = {
            id: (Date.now() + 2).toString(),
            text: 'I apologize for the inconvenience. I\\'m experiencing technical difficulties. Please try again in a moment, or contact our customer service team directly at 1-888-280-4331.',
            sender: 'bot',
            timestamp: new Date(),
          };
          setMessages(prev => [...prev, errorMessage]);
        } finally {
          setIsLoading(false);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      };

      const styles = {
        widget: {
          position: 'fixed',
          bottom: '20px',
          right: '20px',
          zIndex: 1000,
        },
        container: {
          width: '400px',
          height: '620px',
          backgroundColor: '#FFFFFF',
          borderRadius: '8px',
          boxShadow: '0 4px 12px rgba(15, 17, 17, 0.15), 0 0 0 1px rgba(15, 17, 17, 0.05)',
          display: 'flex',
          flexDirection: 'column',
          overflow: 'hidden',
          transform: isOpen ? 'translateY(0) scale(1)' : 'translateY(20px) scale(0.95)',
          opacity: isOpen ? 1 : 0,
          pointerEvents: isOpen ? 'auto' : 'none',
          transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
          fontFamily: "'Amazon Ember', 'Helvetica Neue', Helvetica, Arial, sans-serif",
        },
        hiddenContainer: {
          width: '60px',
          height: '60px',
          borderRadius: '50%',
          background: 'linear-gradient(135deg, #FF9900 0%, #146EB4 100%)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: 'pointer',
          boxShadow: '0 4px 16px rgba(255, 153, 0, 0.4)',
          transition: 'all 0.3s ease',
          border: '2px solid rgba(255,255,255,0.2)',
        },
        header: {
          background: 'linear-gradient(135deg, #232F3E 0%, #37475A 100%)',
          color: '#FFFFFF',
          padding: '16px 20px',
          display: 'flex',
          alignItems: 'center',
          gap: '12px',
          flexShrink: 0,
          borderBottom: '1px solid rgba(255,255,255,0.1)',
        },
        logo: {
          width: '32px',
          height: '32px',
          backgroundColor: '#FF9900',
          borderRadius: '4px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontSize: '18px',
          fontWeight: 'bold',
          color: '#232F3E',
        },
        headerText: {
          flex: 1,
        },
        title: {
          fontSize: '16px',
          fontWeight: '600',
          margin: 0,
          letterSpacing: '-0.025em',
        },
        subtitle: {
          fontSize: '12px',
          opacity: 0.85,
          margin: 0,
          marginTop: '2px',
          fontWeight: '400',
        },
        closeButton: {
          background: 'rgba(255,255,255,0.1)',
          border: 'none',
          color: '#FFFFFF',
          width: '32px',
          height: '32px',
          borderRadius: '4px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: 'pointer',
          fontSize: '16px',
          transition: 'all 0.2s',
        },
        messages: {
          flex: 1,
          padding: '20px',
          overflowY: 'auto',
          backgroundColor: '#FAFAFA',
          scrollBehavior: 'smooth',
        },
        inputArea: {
          padding: '16px 20px',
          backgroundColor: '#FFFFFF',
          borderTop: '1px solid #D5D9D9',
          flexShrink: 0,
        },
        inputContainer: {
          display: 'flex',
          alignItems: 'flex-end',
          gap: '8px',
        },
        input: {
          flex: 1,
          padding: '10px 12px',
          border: '1px solid #888C8C',
          borderRadius: '4px',
          fontSize: '14px',
          outline: 'none',
          resize: 'none',
          transition: 'all 0.2s',
          fontFamily: 'inherit',
          minHeight: '20px',
          maxHeight: '80px',
        },
        sendButton: {
          background: '#FF9900',
          border: '1px solid #A88734',
          color: '#0F1111',
          width: '36px',
          height: '36px',
          borderRadius: '4px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: 'pointer',
          fontSize: '16px',
          transition: 'all 0.2s',
          fontWeight: 'bold',
          flexShrink: 0,
        },
        loading: {
          display: 'flex',
          alignItems: 'center',
          gap: '8px',
          padding: '12px 16px',
          backgroundColor: '#FFFFFF',
          border: '1px solid #D5D9D9',
          borderRadius: '8px',
          borderBottomLeftRadius: '2px',
          alignSelf: 'flex-start',
          maxWidth: '80%',
          fontSize: '14px',
          color: '#565959',
          boxShadow: '0 1px 2px rgba(15, 17, 17, 0.08)',
        },
      };

      return (
        <div style={styles.widget}>
          {isOpen ? (
            <div style={styles.container}>
              <div style={styles.header}>
                <div style={styles.logo}>A</div>
                <div style={styles.headerText}>
                  <h3 style={styles.title}>Customer Service</h3>
                  <p style={styles.subtitle}>We're here to help â€¢ Available 24/7</p>
                </div>
                <button
                  style={styles.closeButton}
                  onClick={() => setIsOpen(false)}
                >
                  Ã—
                </button>
              </div>

              <div ref={messagesContainerRef} style={styles.messages}>
                {messages.map((message) => (
                  <Message key={message.id} {...message} />
                ))}

                {isLoading && (
                  <div style={{ ...styles.loading, alignSelf: 'flex-start' }}>
                    <span>Assistant is typing</span>
                    <div style={{ display: 'flex', gap: '2px' }}>
                      <div style={{ width: '4px', height: '4px', borderRadius: '50%', backgroundColor: '#FF9900', animation: 'amazonPulse 1.4s ease-in-out infinite' }}></div>
                      <div style={{ width: '4px', height: '4px', borderRadius: '50%', backgroundColor: '#FF9900', animation: 'amazonPulse 1.4s ease-in-out infinite', animationDelay: '0.16s' }}></div>
                      <div style={{ width: '4px', height: '4px', borderRadius: '50%', backgroundColor: '#FF9900', animation: 'amazonPulse 1.4s ease-in-out infinite', animationDelay: '0.32s' }}></div>
                    </div>
                  </div>
                )}

                <div ref={messagesEndRef} />
              </div>

              <div style={styles.inputArea}>
                <div style={styles.inputContainer}>
                  <textarea
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyPress={handleKeyPress}
                    placeholder="How can we help you today?"
                    style={styles.input}
                    disabled={isLoading}
                    rows={1}
                  />
                  <button
                    onClick={sendMessage}
                    disabled={isLoading || !input.trim()}
                    style={{
                      ...styles.sendButton,
                      opacity: (isLoading || !input.trim()) ? 0.6 : 1,
                      cursor: (isLoading || !input.trim()) ? 'not-allowed' : 'pointer',
                    }}
                  >
                    â†’
                  </button>
                </div>
              </div>
            </div>
          ) : (
            <div
              style={styles.hiddenContainer}
              onClick={() => setIsOpen(true)}
            >
              <span style={{ fontSize: '24px' }}>ðŸ’¬</span>
            </div>
          )}

          <style>{`
            @keyframes amazonPulse {
              0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
              }
              40% {
                transform: scale(1);
                opacity: 1;
              }
            }

            ::-webkit-scrollbar {
              width: 6px;
            }

            ::-webkit-scrollbar-track {
              background: #F1F1F1;
              border-radius: 3px;
            }

            ::-webkit-scrollbar-thumb {
              background: #888C8C;
              border-radius: 3px;
            }

            ::-webkit-scrollbar-thumb:hover {
              background: #565959;
            }
          `}</style>
        </div>
      );
    };

    const App = () => {
      return (
        <div>
          <AmazonStyleWidget />
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
